{"ast":null,"code":"import { makeAutoObservable, runInAction } from \"mobx\";\nimport agent from '../api/agent';\nimport { v4 as uuid } from 'uuid';\nexport default class ActivityStore {\n  constructor() {\n    this.activities = [];\n    this.activityRegistry = new Map();\n    this.selectedActivity = undefined;\n    this.editMode = false;\n    this.loading = false;\n    this.loadingInitial = false;\n\n    this.loadActivities = async () => {\n      this.setLoadingInit(true);\n\n      try {\n        const activities = await agent.Activities.list();\n        activities.forEach(activity => {\n          activity.date = activity.date.split('T')[0];\n          this.activityRegistry.set(activity.id, activity); // mutate state in\n          //#region Redux is an immutable state management system, but blowbacks is not that kind of library, Moakes creates mutable objects that we can and should mutate directly. \n          //It does not use immutable structures so we can mutate our states inside our method here.\n          //#endregion\n        });\n        this.setLoadingInit(false);\n      } catch (error) {\n        console.log(error);\n        this.setLoadingInit(false);\n      }\n    };\n\n    this.setLoadingInit = state => {\n      this.loadingInitial = state;\n    };\n\n    this.selectActivity = id => {\n      this.selectedActivity = this.activityRegistry.get(id);\n    };\n\n    this.cancelSelectedActivity = () => {\n      this.selectedActivity = undefined;\n    };\n\n    this.openForm = id => {\n      id ? this.selectActivity(id) : this.cancelSelectedActivity();\n      this.editMode = true;\n    };\n\n    this.closeForm = () => {\n      this.editMode = false;\n    };\n\n    this.createActivity = async activity => {\n      this.loading = true;\n      activity.id = uuid();\n\n      try {\n        await agent.Activities.create(activity);\n        runInAction(() => {\n          this.activityRegistry.set(activity.id, activity);\n          this.selectedActivity = activity;\n          this.editMode = false;\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    this.updateActivity = async activity => {\n      this.loading = true;\n\n      try {\n        await agent.Activities.update(activity);\n        runInAction(() => {\n          //this.activities = [...this.activities.filter(x => x.id === activity.id), activity];\n          this.activityRegistry.set(activity.id, activity);\n          this.selectedActivity = activity;\n          this.editMode = false;\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    this.deleteActivity = async id => {\n      this.loading = true;\n\n      try {\n        await agent.Activities.delete(id);\n        runInAction(() => {\n          var _this$selectedActivit;\n\n          //this.activities = [...this.activities.filter(x => x.id !== id)];\n          this.activityRegistry.delete(id);\n          if (((_this$selectedActivit = this.selectedActivity) === null || _this$selectedActivit === void 0 ? void 0 : _this$selectedActivit.id) === id) this.cancelSelectedActivity();\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    makeAutoObservable(this);\n  } // either use promises or async awaits.\n\n\n}","map":{"version":3,"sources":["C:/Users/Mlaistar/source/vs_code/Reactivities/client-app/src/app/stores/activityStore.ts"],"names":["makeAutoObservable","runInAction","agent","v4","uuid","ActivityStore","constructor","activities","activityRegistry","Map","selectedActivity","undefined","editMode","loading","loadingInitial","loadActivities","setLoadingInit","Activities","list","forEach","activity","date","split","set","id","error","console","log","state","selectActivity","get","cancelSelectedActivity","openForm","closeForm","createActivity","create","updateActivity","update","deleteActivity","delete"],"mappings":"AACA,SAASA,kBAAT,EAA6BC,WAA7B,QAAgD,MAAhD;AACA,OAAOC,KAAP,MAAkB,cAAlB;AACA,SAASC,EAAE,IAAIC,IAAf,QAA2B,MAA3B;AAEA,eAAe,MAAMC,aAAN,CAAoB;AAQ/BC,EAAAA,WAAW,GAAG;AAAA,SAPdC,UAOc,GAPW,EAOX;AAAA,SANdC,gBAMc,GANK,IAAIC,GAAJ,EAML;AAAA,SALdC,gBAKc,GAL2BC,SAK3B;AAAA,SAJdC,QAIc,GAJF,KAIE;AAAA,SAHdC,OAGc,GAHJ,KAGI;AAAA,SAFdC,cAEc,GAFG,KAEH;;AAAA,SAKdC,cALc,GAKG,YAAY;AACzB,WAAKC,cAAL,CAAoB,IAApB;;AAEA,UAAI;AAEA,cAAMT,UAAU,GAAG,MAAML,KAAK,CAACe,UAAN,CAAiBC,IAAjB,EAAzB;AACAX,QAAAA,UAAU,CAACY,OAAX,CAAmBC,QAAQ,IAAI;AAC3BA,UAAAA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACC,IAAT,CAAcC,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAAhB;AACA,eAAKd,gBAAL,CAAsBe,GAAtB,CAA0BH,QAAQ,CAACI,EAAnC,EAAuCJ,QAAvC,EAF2B,CAEuB;AAC9C;AACA;AACA;AACL,SANH;AAOE,aAAKJ,cAAL,CAAoB,KAApB;AACL,OAXD,CAWE,OAAOS,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACA,aAAKT,cAAL,CAAoB,KAApB;AACH;AAEJ,KAxBa;;AAAA,SA0BdA,cA1Bc,GA0BIY,KAAD,IAAoB;AACjC,WAAKd,cAAL,GAAsBc,KAAtB;AACH,KA5Ba;;AAAA,SA8BdC,cA9Bc,GA8BIL,EAAD,IAAgB;AAC7B,WAAKd,gBAAL,GAAwB,KAAKF,gBAAL,CAAsBsB,GAAtB,CAA0BN,EAA1B,CAAxB;AACH,KAhCa;;AAAA,SAkCdO,sBAlCc,GAkCW,MAAM;AAC3B,WAAKrB,gBAAL,GAAwBC,SAAxB;AACH,KApCa;;AAAA,SAsCdqB,QAtCc,GAsCFR,EAAD,IAAiB;AACxBA,MAAAA,EAAE,GAAG,KAAKK,cAAL,CAAoBL,EAApB,CAAH,GAA6B,KAAKO,sBAAL,EAA/B;AACA,WAAKnB,QAAL,GAAgB,IAAhB;AACH,KAzCa;;AAAA,SA2CdqB,SA3Cc,GA2CF,MAAM;AACd,WAAKrB,QAAL,GAAgB,KAAhB;AACH,KA7Ca;;AAAA,SA+CdsB,cA/Cc,GA+CG,MAAOd,QAAP,IAA8B;AAE3C,WAAKP,OAAL,GAAe,IAAf;AACAO,MAAAA,QAAQ,CAACI,EAAT,GAAcpB,IAAI,EAAlB;;AAEA,UAAI;AAEA,cAAMF,KAAK,CAACe,UAAN,CAAiBkB,MAAjB,CAAwBf,QAAxB,CAAN;AACAnB,QAAAA,WAAW,CAAC,MAAM;AACd,eAAKO,gBAAL,CAAsBe,GAAtB,CAA0BH,QAAQ,CAACI,EAAnC,EAAuCJ,QAAvC;AACA,eAAKV,gBAAL,GAAwBU,QAAxB;AACA,eAAKR,QAAL,GAAgB,KAAhB;AACA,eAAKC,OAAL,GAAe,KAAf;AACH,SALU,CAAX;AAOH,OAVD,CAUE,OAAOY,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACAxB,QAAAA,WAAW,CAAC,MAAM;AACd,eAAKY,OAAL,GAAe,KAAf;AACH,SAFU,CAAX;AAGH;AACJ,KApEa;;AAAA,SAsEduB,cAtEc,GAsEG,MAAOhB,QAAP,IAA8B;AAC3C,WAAKP,OAAL,GAAe,IAAf;;AAEA,UAAI;AACA,cAAMX,KAAK,CAACe,UAAN,CAAiBoB,MAAjB,CAAwBjB,QAAxB,CAAN;AACAnB,QAAAA,WAAW,CAAC,MAAM;AACd;AACA,eAAKO,gBAAL,CAAsBe,GAAtB,CAA0BH,QAAQ,CAACI,EAAnC,EAAuCJ,QAAvC;AACA,eAAKV,gBAAL,GAAwBU,QAAxB;AACA,eAAKR,QAAL,GAAgB,KAAhB;AACA,eAAKC,OAAL,GAAe,KAAf;AAEH,SAPU,CAAX;AASH,OAXD,CAWE,OAAMY,KAAN,EAAa;AACXC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACAxB,QAAAA,WAAW,CAAC,MAAM;AACd,eAAKY,OAAL,GAAe,KAAf;AACH,SAFU,CAAX;AAGH;AACJ,KA1Fa;;AAAA,SA4FdyB,cA5Fc,GA4FG,MAAOd,EAAP,IAAsB;AACnC,WAAKX,OAAL,GAAe,IAAf;;AACA,UAAI;AACA,cAAMX,KAAK,CAACe,UAAN,CAAiBsB,MAAjB,CAAwBf,EAAxB,CAAN;AACAvB,QAAAA,WAAW,CAAC,MAAM;AAAA;;AACd;AACA,eAAKO,gBAAL,CAAsB+B,MAAtB,CAA6Bf,EAA7B;AACA,cAAG,+BAAKd,gBAAL,gFAAuBc,EAAvB,MAA8BA,EAAjC,EAAqC,KAAKO,sBAAL;AACrC,eAAKlB,OAAL,GAAe,KAAf;AAEH,SANU,CAAX;AAOH,OATD,CASE,OAAOY,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACAxB,QAAAA,WAAW,CAAC,MAAM;AACd,eAAKY,OAAL,GAAe,KAAf;AACH,SAFU,CAAX;AAGH;AACJ,KA7Ga;;AACVb,IAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACH,GAV8B,CAY/B;;;AAZ+B","sourcesContent":["import { Activity } from './../models/activity';\r\nimport { makeAutoObservable, runInAction } from \"mobx\";\r\nimport agent from '../api/agent';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nexport default class ActivityStore {\r\n    activities: Activity[] = [];\r\n    activityRegistry = new Map<string, Activity>();\r\n    selectedActivity: Activity | undefined = undefined;\r\n    editMode =  false;\r\n    loading = false;\r\n    loadingInitial = false;\r\n    \r\n    constructor() {\r\n        makeAutoObservable(this)\r\n    }\r\n\r\n    // either use promises or async awaits.\r\n    loadActivities = async () => {\r\n        this.setLoadingInit(true);\r\n\r\n        try {\r\n            \r\n            const activities = await agent.Activities.list();\r\n            activities.forEach(activity => {\r\n                activity.date = activity.date.split('T')[0]\r\n                this.activityRegistry.set(activity.id, activity); // mutate state in\r\n                    //#region Redux is an immutable state management system, but blowbacks is not that kind of library, Moakes creates mutable objects that we can and should mutate directly. \r\n                    //It does not use immutable structures so we can mutate our states inside our method here.\r\n                    //#endregion\r\n              })\r\n              this.setLoadingInit(false);\r\n        } catch (error) {\r\n            console.log(error);\r\n            this.setLoadingInit(false);\r\n        }\r\n\r\n    }\r\n\r\n    setLoadingInit = (state: boolean) => {\r\n        this.loadingInitial = state;\r\n    }\r\n    \r\n    selectActivity = (id: string) => {\r\n        this.selectedActivity = this.activityRegistry.get(id);\r\n    }\r\n\r\n    cancelSelectedActivity = () => {\r\n        this.selectedActivity = undefined;\r\n    }\r\n\r\n    openForm = (id?: string) => {\r\n        id ? this.selectActivity(id) : this.cancelSelectedActivity();\r\n        this.editMode = true;\r\n    }\r\n\r\n    closeForm = () => {\r\n        this.editMode = false;\r\n    }\r\n\r\n    createActivity = async (activity: Activity) => {\r\n        \r\n        this.loading = true;\r\n        activity.id = uuid();\r\n\r\n        try {\r\n\r\n            await agent.Activities.create(activity);\r\n            runInAction(() => {\r\n                this.activityRegistry.set(activity.id, activity);\r\n                this.selectedActivity = activity;\r\n                this.editMode = false;\r\n                this.loading = false;\r\n            })\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n\r\n    updateActivity = async (activity: Activity) => {\r\n        this.loading = true;\r\n\r\n        try {\r\n            await agent.Activities.update(activity);\r\n            runInAction(() => {\r\n                //this.activities = [...this.activities.filter(x => x.id === activity.id), activity];\r\n                this.activityRegistry.set(activity.id, activity);\r\n                this.selectedActivity = activity;\r\n                this.editMode = false;\r\n                this.loading = false;\r\n\r\n            })\r\n\r\n        } catch(error) {\r\n            console.log(error)\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n\r\n    deleteActivity = async (id: string) => {\r\n        this.loading = true;\r\n        try {\r\n            await agent.Activities.delete(id);\r\n            runInAction(() => {\r\n                //this.activities = [...this.activities.filter(x => x.id !== id)];\r\n                this.activityRegistry.delete(id);\r\n                if(this.selectedActivity?.id === id) this.cancelSelectedActivity();\r\n                this.loading = false;\r\n\r\n            })\r\n        } catch (error) {\r\n            console.log(error);\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}