{"ast":null,"code":"import { makeAutoObservable, runInAction } from \"mobx\";\nimport agent from '../api/agent';\nimport { v4 as uuid } from 'uuid';\nexport default class ActivityStore {\n  //activities: Activity[] = [];\n  constructor() {\n    this.activityRegistry = new Map();\n    this.selectedActivity = undefined;\n    this.editMode = false;\n    this.loading = false;\n    this.loadingInitial = true;\n\n    this.loadActivities = async () => {\n      try {\n        const activities = await agent.Activities.list();\n        activities.forEach(activity => {\n          activity.date = activity.date.split('T')[0];\n          this.activityRegistry.set(activity.id, activity); // mutate state in\n          //#region Redux is an immutable state management system, but blowbacks is not that kind of library, Moakes creates mutable objects that we can and should mutate directly. \n          //It does not use immutable structures so we can mutate our states inside our method here.\n          //#endregion\n        });\n        this.setLoadingInit(false);\n      } catch (error) {\n        console.log(error);\n        this.setLoadingInit(false);\n      }\n    };\n\n    this.setLoadingInit = state => {\n      this.loadingInitial = state;\n    };\n\n    this.selectActivity = id => {\n      this.selectedActivity = this.activityRegistry.get(id);\n    };\n\n    this.cancelSelectedActivity = () => {\n      this.selectedActivity = undefined;\n    };\n\n    this.openForm = id => {\n      id ? this.selectActivity(id) : this.cancelSelectedActivity();\n      this.editMode = true;\n    };\n\n    this.closeForm = () => {\n      this.editMode = false;\n    };\n\n    this.createActivity = async activity => {\n      this.loading = true;\n      activity.id = uuid();\n\n      try {\n        await agent.Activities.create(activity);\n        runInAction(() => {\n          this.activityRegistry.set(activity.id, activity);\n          this.selectedActivity = activity;\n          this.editMode = false;\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    this.updateActivity = async activity => {\n      this.loading = true;\n\n      try {\n        await agent.Activities.update(activity);\n        runInAction(() => {\n          //this.activities = [...this.activities.filter(x => x.id === activity.id), activity];\n          this.activityRegistry.set(activity.id, activity);\n          this.selectedActivity = activity;\n          this.editMode = false;\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    this.deleteActivity = async id => {\n      this.loading = true;\n\n      try {\n        await agent.Activities.delete(id);\n        runInAction(() => {\n          var _this$selectedActivit;\n\n          //this.activities = [...this.activities.filter(x => x.id !== id)];\n          this.activityRegistry.delete(id);\n          if (((_this$selectedActivit = this.selectedActivity) === null || _this$selectedActivit === void 0 ? void 0 : _this$selectedActivit.id) === id) this.cancelSelectedActivity();\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        runInAction(() => {\n          this.loading = false;\n        });\n      }\n    };\n\n    makeAutoObservable(this);\n  }\n\n  get ActivitiesByDate() {\n    return Array.from(this.activityRegistry.values()).sort((a, b) => Date.parse(a.date) - Date.parse(b.date));\n  } // either use promises or async awaits.\n\n\n}","map":{"version":3,"sources":["C:/Users/Mlaistar/source/vs_code/Reactivities/client-app/src/app/stores/activityStore.ts"],"names":["makeAutoObservable","runInAction","agent","v4","uuid","ActivityStore","constructor","activityRegistry","Map","selectedActivity","undefined","editMode","loading","loadingInitial","loadActivities","activities","Activities","list","forEach","activity","date","split","set","id","setLoadingInit","error","console","log","state","selectActivity","get","cancelSelectedActivity","openForm","closeForm","createActivity","create","updateActivity","update","deleteActivity","delete","ActivitiesByDate","Array","from","values","sort","a","b","Date","parse"],"mappings":"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","sourcesContent":["import { Activity } from './../models/activity';\r\nimport { makeAutoObservable, runInAction } from \"mobx\";\r\nimport agent from '../api/agent';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nexport default class ActivityStore {\r\n    //activities: Activity[] = [];\r\n    activityRegistry = new Map<string, Activity>();\r\n    selectedActivity: Activity | undefined = undefined;\r\n    editMode =  false;\r\n    loading = false;\r\n    loadingInitial = true;\r\n    \r\n    constructor() {\r\n        makeAutoObservable(this)\r\n    }\r\n\r\nget ActivitiesByDate() {\r\n  return Array.from(this.activityRegistry.values()).sort((a, b) => \r\n        Date.parse(a.date) - Date.parse(b.date))  ;\r\n}\r\n\r\n    // either use promises or async awaits.\r\n    loadActivities = async () => {\r\n\r\n        try {\r\n            \r\n            const activities = await agent.Activities.list();\r\n            activities.forEach(activity => {\r\n                activity.date = activity.date.split('T')[0]\r\n                this.activityRegistry.set(activity.id, activity); // mutate state in\r\n                    //#region Redux is an immutable state management system, but blowbacks is not that kind of library, Moakes creates mutable objects that we can and should mutate directly. \r\n                    //It does not use immutable structures so we can mutate our states inside our method here.\r\n                    //#endregion\r\n              })\r\n              this.setLoadingInit(false);\r\n        } catch (error) {\r\n            console.log(error);\r\n            this.setLoadingInit(false);\r\n        }\r\n\r\n    }\r\n\r\n    setLoadingInit = (state: boolean) => {\r\n        this.loadingInitial = state;\r\n    }\r\n    \r\n    selectActivity = (id: string) => {\r\n        this.selectedActivity = this.activityRegistry.get(id);\r\n    }\r\n\r\n    cancelSelectedActivity = () => {\r\n        this.selectedActivity = undefined;\r\n    }\r\n\r\n    openForm = (id?: string) => {\r\n        id ? this.selectActivity(id) : this.cancelSelectedActivity();\r\n        this.editMode = true;\r\n    }\r\n\r\n    closeForm = () => {\r\n        this.editMode = false;\r\n    }\r\n\r\n    createActivity = async (activity: Activity) => {\r\n        \r\n        this.loading = true;\r\n        activity.id = uuid();\r\n\r\n        try {\r\n\r\n            await agent.Activities.create(activity);\r\n            runInAction(() => {\r\n                this.activityRegistry.set(activity.id, activity);\r\n                this.selectedActivity = activity;\r\n                this.editMode = false;\r\n                this.loading = false;\r\n            })\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n\r\n    updateActivity = async (activity: Activity) => {\r\n        this.loading = true;\r\n\r\n        try {\r\n            await agent.Activities.update(activity);\r\n            runInAction(() => {\r\n                //this.activities = [...this.activities.filter(x => x.id === activity.id), activity];\r\n                this.activityRegistry.set(activity.id, activity);\r\n                this.selectedActivity = activity;\r\n                this.editMode = false;\r\n                this.loading = false;\r\n\r\n            })\r\n\r\n        } catch(error) {\r\n            console.log(error)\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n\r\n    deleteActivity = async (id: string) => {\r\n        this.loading = true;\r\n        try {\r\n            await agent.Activities.delete(id);\r\n            runInAction(() => {\r\n                //this.activities = [...this.activities.filter(x => x.id !== id)];\r\n                this.activityRegistry.delete(id);\r\n                if(this.selectedActivity?.id === id) this.cancelSelectedActivity();\r\n                this.loading = false;\r\n\r\n            })\r\n        } catch (error) {\r\n            console.log(error);\r\n            runInAction(() => {\r\n                this.loading = false;\r\n            })\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}